<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record id="view_vr_game_result_tree" model="ir.ui.view">
            <field name="name">vr.game.result.tree</field>
            <field name="model">vr.game.result</field>
            <field name="arch" type="xml">
                <tree string="Game Result" create="0" edit="0">
                    <field name="id" groups="base.group_no_one"/>
                    <field name="name"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="device_id" optional="hide"/>
                    <field name="session_start"/>
                    <field name="session_end"/>
                    <field name="domain" optional="hide"/>
                    <field name="game_code"/>
                    <field name="challenge_code"/>
                    <!--<field name="game_level_id"/>-->
                    <field name="reaction_time_str" optional="hide"/>
                    <!--<field name="violation"/>-->
                    <field name="selection"/>
                    <field name="score"/>
                    <field name="remark"/>
                    <field name="create_date" groups="base.group_no_one" optional="hide"/>
                </tree>
            </field>
        </record>

        <record id="view_vr_game_result_form" model="ir.ui.view">
            <field name="name">vr.game.result.form</field>
            <field name="model">vr.game.result</field>
            <field name="arch" type="xml">
                <form string="Training Result" create="0" edit="1">
                    <sheet>
                        <group>
                            <group>
                                <field name="name" readonly="0" groups="base.group_system"/>
                                <field name="vr_trainee_id" options="{'no_open': True}" groups="base.group_no_one"/>
                                <field name="company_code" readonly="0" groups="base.group_system"/>
                                <field name="company_id" groups="base.group_multi_company"/>
                                <field name="game_code" readonly="1"/>
                                <field name="vr_game_id" options="{'no_open': True}" groups="base.group_no_one"/>
                                <field name="game_challenge_id" options="{'no_open': True}" groups="base.group_no_one"/>
                                <field name="challenge_code" readonly="0" groups="base.group_system"/>
                                <field name="selection" readonly="1"/>
                                <!--<field name="level_code" groups="base.group_no_one"/>
                                <field name="game_level_id"/>-->
                                <field name="device_id"/>
                                <field name="domain"/>
                                <field name="experience" readonly="1"/>
                            </group>
                            <group>
                                <!--<field name="violation"/>-->
                                <field name="session_start"/>
                                <field name="session_start_str" groups="base.group_no_one"/>
                                <field name="session_end"/>
                                <field name="session_end_str" groups="base.group_no_one"/>
                                <field name="reaction_time_str" readonly="1"/>
                                <field name="view_time_str" readonly="1"/>
                                <field name="score"/>
                                <field name="score_str" groups="base.group_no_one"/>
                                <field name="remark" readonly="1"/>
                                <field name="vr_mail_id" groups="base.group_no_one" readonly="1"/>
                                <field name="game_session_id" groups="base.group_no_one" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter" groups="base.group_no_one">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="action_vr_game_result" model="ir.actions.act_window">
            <field name="name">VR Game Results</field>
            <field name="res_model">vr.game.result</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.server" id="action_game_result_resync_data">
            <field name="name">Resync Data</field>
            <field name="model_id" ref="virsat.model_vr_game_result"/>
            <!--<field name="groups_id" eval="[(4, ref('virsat.group_manager'))]"/>-->
            <field name="binding_model_id" ref="virsat.model_vr_game_result" />
            <field name="state">code</field>
            <field name="binding_view_types">list,form</field>
            <field name="code">
if records:
    records.resync_data()
            </field>
        </record>

        <!-- Game Result Report -->
        <record id="view_vr_game_result_report_kanban" model="ir.ui.view">
            <field name="name">vr.game.result.report.kanban</field>
            <field name="model">vr.game.result.report</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" create="false" group_create="false" group_edit="false" group_delete="false" archivable="false" quick_create="false" delete="false" edit="false" records_draggable="0">
                    <templates>
                        <field name="game_id"/>
                        <field name="remark"/>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_content flex-grow-1">
                                <div class="o_kanban_record_title oe_kanban_details">
                                    <h3 t-if="record.challenge_id.raw_value">
                                        <field name="challenge_id" options="{'no_open': True, 'no_create_edit': True}"/>
                                    </h3>
                                    <h3 t-else="" class="text-danger">
                                        Undefined Challenge: <field name="challenge_code"/>
                                    </h3>
                                </div>
                                <div class="o_kanban_record_subtitle">
                                    <field name="game_id"/>
                                </div>
                                 <div class="row mt-2">
                                    <div><strong>PIN: </strong><field name="pin"/></div>
                                    <div><strong>Name: </strong><field name="trainee_name" groups="virsat.group_view_vr_trainee_name"/></div>
                                    <div><strong>Session Start: </strong><field name="session_start"/></div>
                                    <div><strong>Session End: </strong><field name="session_end"/></div>
                                    <!--<div><strong>Challenge: </strong><field name="challenge_id"/></div>-->
                                    <div><strong>Language: </strong><field name="language"/></div>
                                    <div t-if="record.selection.raw_value != ''"><strong>Selection: </strong><field name="selection"/></div>
                                    <div t-if="record.score.raw_value > 0"><strong>Score: </strong><field name="score"/></div>
                                    <div class="mt-2">
                                        <t t-if="record.remark.raw_value == 'Passed' or record.remark.raw_value == 'Correct'">
                                            <div class="h1"><i class="fa fa-check-circle text-success text-capitalize" title="Status"/> <field name="remark"/></div>
                                        </t>
                                        <t t-else="">
                                            <div class="h1"><i class="fa fa-times-circle-o text-danger text-capitalize" title="Status"/> <field name="remark"/></div>
                                        </t>
                                    </div>
                                 </div>
                            </div>

                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_vr_game_result_report_tree" model="ir.ui.view">
            <field name="name">vr.game.result.report.tree</field>
            <field name="model">vr.game.result.report</field>
            <field name="arch" type="xml">
                <tree create="0" decoration-danger="remark not in ('Passed', 'Correct')">
                    <field name="id" groups="base.group_system"/>
                    <field name="pin"/>
                    <field name="trainee_name"/>
                    <field name="session_start" optional="show"/>
                    <field name="session_end" optional="show"/>
                    <field name="game_id"/>
                    <field name="language"/>
                    <field name="challenge_id"/>
                    <field name="selection"/>
                    <field name="score"/>
                    <field name="remark"/>
                    <field name="status"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>

        <record id="view_vr_game_result_report_search" model="ir.ui.view">
            <field name="name">vr.game.result.report.search</field>
            <field name="model">vr.game.result.report</field>
            <field name="arch" type="xml">
                <search>
                    <field name="pin"/>
                    <field name="trainee_name" groups="virsat.group_view_vr_trainee_name"/>
                    <!--<filter name="passed" domain="[('remark', 'in', ('Passed', 'Correct'))]" string="Passed/Correct"/>
                    <filter name="failed" domain="[('remark', 'not in', ('Passed', 'Correct'))]" string="Failed/Inorrect"/>-->
                    <filter string="Challenge" name="level" context="{'group_by':'challenge_id'}"/>
                    <filter string="Game" name="game" context="{'group_by':'game_id'}"/>
                    <filter string="PIN" name="trainee" context="{'group_by':'pin'}"/>
                    <filter string="Trainee Name" name="trainee" context="{'group_by':'trainee_name'}" groups="virsat.group_view_vr_trainee_name"/>
                    <filter string="Session" name="session" context="{'group_by':'session_start'}"/>
                </search>
            </field>
        </record>

        <record id="action_vr_game_result_report" model="ir.actions.act_window">
            <field name="name">Training Results</field>
            <field name="res_model">vr.game.result.report</field>
            <field name="view_mode">tree,pivot</field>
            <field name="domain">[]</field>
            <field name="context">{'group_by': ['pin','game_id','session_start:day','challenge_id'], 'pivot_measures': ['__count'], 'pivot_column_groupby': ['status'], 'pivot_row_groupby': ['pin', 'game_id','session_start:day','challenge_id']}</field>
        </record>

        <record model="ir.actions.client" id="client_action_dashboard">
            <field name="name">Dashboard</field>
            <field name="tag">virsat.dashboard</field>
        </record>
    </data>
</odoo>